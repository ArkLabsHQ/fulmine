package pages

import (
	"fmt"
	"github.com/ArkLabsHQ/fulmine/internal/interface/web/templates/components"
	"github.com/ArkLabsHQ/fulmine/internal/interface/web/types"
)

templ DelegatorTab(kind string, active bool) {
	<div
		id={kind}
		class={"flex", "rounded-lg", templ.KV("bg-white", active), templ.KV("text-black", active)}
		hx-get={"/delegator/" + kind}
		hx-target="#delegatorPartial">
		<p class="px-3 py-2.5 flex items-center gap-2 mx-auto cursor-pointer">
			{kind}
		</p>
	</div>
}

templ DelegatorTabs(active string) {
	<div class="grid grid-cols-4 gap-2 mt-10 mb-8 text-sm text-white/80 font-semibold">
		@DelegatorTab("pending", active == "pending")
		@DelegatorTab("completed", active == "completed")
		@DelegatorTab("failed", active == "failed")
		@DelegatorTab("cancelled", active == "cancelled")
	</div>
}

templ DelegatorPartialContent(active string) {
	<div id="delegatorPartial">
		@DelegatorTabs(active)
		<div hx-get={"/delegate/tasks/" + active + "/0"} hx-trigger="load" />
	</div>
}

templ DelegatorBodyContent() {
	@components.DesktopHeader()
	<div id="delegatorBody">
		<div class="p-3 flex flex-col justify-between rounded-lg h-screen md:h-auto md:bg-desktopbg">
			<div>
				@components.Header("Delegator Dashboard")
				@DelegatorPartialContent("pending")
			</div>
		</div>
	</div>
}

templ DelegatorTasksListContent(tasks []types.DelegateTask, status string, offset int, loadMore bool) {
	if len(tasks) == 0 {
		@components.HistoryEmpty()
	} else {
		for _, task := range tasks {
			<hr class="border border-1 border-white/10 w-full"/>
			@components.DelegateTaskHistoryLine(task)
		}
		if loadMore {
			<div class="flex justify-center" hx-get={"/delegate/tasks/" + status + "/" + fmt.Sprintf("%d", offset)} hx-swap="outerHTML">
				<p class="cursor-pointer p-3 text-semibold text-sm text-white/50 hover:text-white/80">Load more</p>
			</div>
		}
	}
}
